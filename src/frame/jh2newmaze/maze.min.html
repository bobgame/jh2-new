<!DOCTYPE html><html lang="en"><head><title>Maze for JH2 New</title><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><style>*{box-sizing:border-box}body{margin:0 auto}canvas{grid-area:canvas}.maze-controls{width:100%;height:80px;background-color:#cccccc12;position:relative}.down,.left,.right,.up{position:absolute;cursor:pointer;color:#83694e;font-size:1.2em;width:60px;height:40px;border-radius:6px;display:flex;align-items:center;justify-content:center;outline:0;border:2px solid #83694e;background-color:rgba(255,243,205,.8)}.up{left:150px;top:0}.up svg{transform:rotate(-90deg)}.right{left:220px;top:24px}.down{left:150px;top:48px}.down svg{transform:rotate(90deg)}.left{left:80px;top:24px}.left svg{transform:rotate(180deg)}</style><script src="./hammer.min.js"></script></head><body><canvas id="main-canvas"></canvas><div class="maze-controls"><button id="up" class="up"><svg style="width: 1em; height: 1em; vertical-align: middle; fill: currentColor; overflow: hidden" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M730.564 550.46c-0.36 0.359-0.856 0.449-1.214 0.788l-359.113 394.661c-21.692 21.242-56.657 21.489-78.054 0.518-21.398-20.972-21.173-55.193 0.54-76.459l325.045-357.221-325.698-357.92c-21.69-21.263-21.713-55.689-0.045-76.929 21.691-21.218 56.837-21.196 78.55 0.045l359.966 395.608c21.691 21.241 21.713 55.689 0.022 76.908z" fill="#83694e"></path></svg></button> <button id="right" class="right"><svg style="width: 1em; height: 1em; vertical-align: middle; fill: currentColor; overflow: hidden" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M730.564 550.46c-0.36 0.359-0.856 0.449-1.214 0.788l-359.113 394.661c-21.692 21.242-56.657 21.489-78.054 0.518-21.398-20.972-21.173-55.193 0.54-76.459l325.045-357.221-325.698-357.92c-21.69-21.263-21.713-55.689-0.045-76.929 21.691-21.218 56.837-21.196 78.55 0.045l359.966 395.608c21.691 21.241 21.713 55.689 0.022 76.908z" fill="#83694e"></path></svg></button> <button id="down" class="down"><svg style="width: 1em; height: 1em; vertical-align: middle; fill: currentColor; overflow: hidden" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M730.564 550.46c-0.36 0.359-0.856 0.449-1.214 0.788l-359.113 394.661c-21.692 21.242-56.657 21.489-78.054 0.518-21.398-20.972-21.173-55.193 0.54-76.459l325.045-357.221-325.698-357.92c-21.69-21.263-21.713-55.689-0.045-76.929 21.691-21.218 56.837-21.196 78.55 0.045l359.966 395.608c21.691 21.241 21.713 55.689 0.022 76.908z" fill="#83694e"></path></svg></button> <button id="left" class="left"><svg style="width: 1em; height: 1em; vertical-align: middle; fill: currentColor; overflow: hidden" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M730.564 550.46c-0.36 0.359-0.856 0.449-1.214 0.788l-359.113 394.661c-21.692 21.242-56.657 21.489-78.054 0.518-21.398-20.972-21.173-55.193 0.54-76.459l325.045-357.221-325.698-357.92c-21.69-21.263-21.713-55.689-0.045-76.929 21.691-21.218 56.837-21.196 78.55 0.045l359.966 395.608c21.691 21.241 21.713 55.689 0.022 76.908z" fill="#83694e"></path></svg></button></div><script>let l,e,s,t,i,o;class c{constructor(){this.reset()}reset(){this.col=0,this.row=0}}class r{constructor(l,e){this.col=l,this.row=e,this.eastWall=!0,this.northWall=!0,this.southWall=!0,this.westWall=!0,this.visited=!1}}class h{constructor(l,e,s){this.backgroundColor="#ffe7a9",this.cols=l,this.endColor="rgb(0,255,0)",this.mazeColor="rgb(100,70,15)",this.playerColor="rgb(40,137,168)",this.rows=e,this.cellSize=s,this.cells=[],this.generate()}generate(){t=this.rows*this.cellSize,i=this.cols*this.cellSize,e.height=t,e.width=i,e.style.height=t,e.style.width=i;for(let l=0;l<this.cols;l++){this.cells[l]=[];for(let e=0;e<this.rows;e++)this.cells[l][e]=new r(l,e)}let l,s,o,c,h=Math.floor(Math.random()*this.cols),a=Math.floor(Math.random()*this.rows),n=[];for(n.push(this.cells[h][a]);this.hasUnvisited(this.cells);)if(l=n[n.length-1],l.visited=!0,this.hasUnvisitedNeighbor(l)){c=null,o=!1;do{switch(s=Math.floor(4*Math.random()),s){case 0:l.col===this.cols-1||this.cells[l.col+1][l.row].visited||(l.eastWall=!1,c=this.cells[l.col+1][l.row],c.westWall=!1,o=!0);break;case 1:0===l.row||this.cells[l.col][l.row-1].visited||(l.northWall=!1,c=this.cells[l.col][l.row-1],c.southWall=!1,o=!0);break;case 2:l.row===this.rows-1||this.cells[l.col][l.row+1].visited||(l.southWall=!1,c=this.cells[l.col][l.row+1],c.northWall=!1,o=!0);break;case 3:0===l.col||this.cells[l.col-1][l.row].visited||(l.westWall=!1,c=this.cells[l.col-1][l.row],c.eastWall=!1,o=!0)}o&&n.push(c)}while(!o)}else l=n.pop();this.redraw()}hasUnvisited(){for(let l=0;l<this.cols;l++)for(let e=0;e<this.rows;e++)if(!this.cells[l][e].visited)return!0;return!1}hasUnvisitedNeighbor(l){return 0!==l.col&&!this.cells[l.col-1][l.row].visited||l.col!==this.cols-1&&!this.cells[l.col+1][l.row].visited||0!==l.row&&!this.cells[l.col][l.row-1].visited||l.row!==this.rows-1&&!this.cells[l.col][l.row+1].visited}redraw(){l.fillStyle=this.backgroundColor,l.fillRect(0,0,i,t),l.fillStyle=this.endColor,l.fillRect((this.cols-1)*this.cellSize,(this.rows-1)*this.cellSize,this.cellSize,this.cellSize),l.strokeStyle=this.mazeColor,l.strokeRect(0,0,i,t);for(let e=0;e<this.cols;e++)for(let s=0;s<this.rows;s++)this.cells[e][s].eastWall&&(l.beginPath(),l.moveTo((e+1)*this.cellSize,s*this.cellSize),l.lineTo((e+1)*this.cellSize,(s+1)*this.cellSize),l.stroke()),this.cells[e][s].northWall&&(l.beginPath(),l.moveTo(e*this.cellSize,s*this.cellSize),l.lineTo((e+1)*this.cellSize,s*this.cellSize),l.stroke()),this.cells[e][s].southWall&&(l.beginPath(),l.moveTo(e*this.cellSize,(s+1)*this.cellSize),l.lineTo((e+1)*this.cellSize,(s+1)*this.cellSize),l.stroke()),this.cells[e][s].westWall&&(l.beginPath(),l.moveTo(e*this.cellSize,s*this.cellSize),l.lineTo(e*this.cellSize,(s+1)*this.cellSize),l.stroke());l.fillStyle=this.playerColor,l.fillRect(o.col*this.cellSize+3,o.row*this.cellSize+3,this.cellSize-6,this.cellSize-6),this.cols-1===o.col&&this.rows-1===o.row&&z()}}function control(l){switch(l){case"left":s.cells[o.col][o.row].westWall||(o.col-=1);break;case"right":s.cells[o.col][o.row].eastWall||(o.col+=1);break;case"down":s.cells[o.col][o.row].southWall||(o.row+=1);break;case"up":s.cells[o.col][o.row].northWall||(o.row-=1)}s.redraw()}function a(l){switch(l.keyCode){case 37:case 65:s.cells[o.col][o.row].westWall||(o.col-=1);break;case 39:case 68:s.cells[o.col][o.row].eastWall||(o.col+=1);break;case 40:case 83:s.cells[o.col][o.row].southWall||(o.row+=1);break;case 38:case 87:s.cells[o.col][o.row].northWall||(o.row-=1)}s.redraw()}var n,w,d,u;function f(){return(new Date).getTime()}function z(){try{window.parent.postMessage({type:"maze-to-jh2",data:{key:"maze-win",status:!0}},"*")}catch(l){}}function S(l){var e=document.getElementById(l),s=new Hammer(e);s.on("press tap",(function(e){"tap"==e.type?control(l):timers[l]=setInterval((()=>{control(l),console.log("press",(new Date).getTime())}),120)})),s.on("pressup",(function(){console.log("pressup",(new Date).getTime()),clearInterval(timers[l])}))}function g(){e=document.getElementById("main-canvas"),l=e.getContext("2d"),o=new c,s=new h(15,12,24),document.addEventListener("keydown",a),S("left"),S("right"),S("down"),S("up")}timers={left:null,right:null,up:null,down:null},window.onload=g;</script></body></html>